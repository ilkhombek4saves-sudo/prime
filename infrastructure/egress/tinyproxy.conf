# ═══════════════════════════════════════════════════════════════════════════════
# Tinyproxy Configuration - Egress Control for Prime AI Agent
# Только разрешенные AI API домены
# ═══════════════════════════════════════════════════════════════════════════════

# Порт для прослушивания (внутренний)
Port 8888

# Слушаем на всех интерфейсах (внутри docker network)
Listen 0.0.0.0

# Bind на конкретный адрес (опционально)
# Bind 172.28.2.10

# ═══════════════════════════════════════════════════════════════════════════════
# БЕЗОПАСНОСТЬ
# ═══════════════════════════════════════════════════════════════════════════════

# Разрешаем подключаться только из внутренних сетей
Allow 172.28.0.0/16   # Docker networks
Allow 127.0.0.1       # Localhost
Allow 10.0.0.0/8      # Private networks
Allow 192.168.0.0/16  # Private networks

# Запрещаем все остальные подключения
Allow 0.0.0.0/0

# Включаем whitelist фильтрацию
FilterURLs On
FilterExtended On
FilterCaseSensitive Off
FilterDefaultDeny Yes
Filter "/etc/tinyproxy/whitelist.txt"

# ═══════════════════════════════════════════════════════════════════════════════
# ЛОГИРОВАНИЕ
# ═══════════════════════════════════════════════════════════════════════════════

# Уровень логирования:
# Connect - только подключения
# Info - информационные сообщения
# Notice - важные события
# Warning - предупреждения
# Error - ошибки
# Critical - критические ошибки
LogLevel Info

# Путь к лог-файлу
LogFile "/var/log/tinyproxy/tinyproxy.log"

# Также логируем в syslog
# Syslog On

# PID файл
PidFile "/var/run/tinyproxy/tinyproxy.pid"

# ═══════════════════════════════════════════════════════════════════════════════
# ПРОИЗВОДИТЕЛЬНОСТЬ
# ═══════════════════════════════════════════════════════════════════════════════

# Минимальное количество spare серверов
MinSpareServers 5

# Максимальное количество spare серверов
MaxSpareServers 20

# Начальное количество серверов
StartServers 10

# Максимальное количество серверов
MaxServers 100

# Максимальное количество подключений на сервер
MaxRequestsPerChild 1000

# Таймаут подключения (в секундах)
Timeout 60

# Максимальный размер HTTP заголовка (в байтах)
MaxRequestSize 8192

# ═══════════════════════════════════════════════════════════════════════════════
# АУТЕНТИФИКАЦИЯ (опционально)
# ═══════════════════════════════════════════════════════════════════════════════

# Basic auth (раскомментировать для дополнительной безопасности)
# BasicAuth user password

# ═══════════════════════════════════════════════════════════════════════════════
# ДОПОЛНИТЕЛЬНЫЕ НАСТРОЙКИ
# ═══════════════════════════════════════════════════════════════════════════════

# Включаем Via заголовок
ViaProxyName "prime-egress-proxy"

# Отключаем опцию forward proxy для анонимности
DisableViaHeader No

# Запрещаем CONNECT метод (не нужен для HTTPS проксирования)
# ConnectPort 443
# ConnectPort 563

# Анонимность заголовков
# Anonymous headers to allow (empty = allow all)
# Anonymous "Authorization"
# Anonymous "Cookie"
# Anonymous "From"
# Anonymous "Host"
# Anonymous "Referer"
# Anonymous "User-Agent"

# ═══════════════════════════════════════════════════════════════════════════════
# ОБРАБОТКА ОШИБОК
# ═══════════════════════════════════════════════════════════════════════════════

# Страница ошибки по умолчанию
# DefaultErrorFile "/usr/share/tinyproxy/default.html"

# Статистика (отключено для безопасности)
StatFile "/usr/share/tinyproxy/stats.html"
