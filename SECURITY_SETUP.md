# Prime AI Agent - Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ°Ñ Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° (White API)

Ğ”Ğ°Ğ½Ğ½Ğ¾Ğµ Ñ€ÑƒĞºĞ¾Ğ²Ğ¾Ğ´ÑÑ‚Ğ²Ğ¾ Ğ¾Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºÑƒ ÑĞµÑ€Ğ²ĞµÑ€Ğ° Prime Ñ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ¸Ñ€ÑƒĞµĞ¼Ñ‹Ğ¼ Ğ¸ÑÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğ¼ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ¾Ğ¼ (egress). Ğ¡ĞµÑ€Ğ²ĞµÑ€ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¾Ğ±Ñ€Ğ°Ñ‰Ğ°Ñ‚ÑŒÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğº Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ½Ñ‹Ğ¼ AI API, Ğ²ÑĞµ Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¸ÑÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒÑÑ‚ÑÑ.

## ğŸ¯ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         INTERNET                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ OpenAI  â”‚ â”‚Anthropic â”‚ â”‚ DeepSeek â”‚ â”‚ Telegram â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚           â”‚            â”‚            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ HTTPS only
                           â”‚ Whitelist filter
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     EGRESS PROXY (Tinyproxy)                   â”‚
â”‚              â€¢ Domain whitelist filtering                       â”‚
â”‚              â€¢ Request logging                                  â”‚
â”‚              â€¢ Access control                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend     â”‚  â”‚ Browser Bridge  â”‚  â”‚  External    â”‚
â”‚  (FastAPI)   â”‚  â”‚  (Playwright)   â”‚  â”‚   Tools      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚    Internal Network     â”‚
              â”‚      (no internet)      â”‚
              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
              â”‚  â”‚  DB   â”‚ â”‚  Redis  â”‚ â”‚
              â”‚  â”‚(PG)   â”‚ â”‚ (Cache) â”‚ â”‚
              â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
              â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Caddy (HTTPS)  â”‚
            â”‚  Reverse Proxy  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
              PUBLIC INTERNET
              (Users/Bots)
```

## ğŸš€ Ğ‘Ñ‹ÑÑ‚Ñ€Ğ°Ñ Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°

### 1. ĞšĞ»Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸ Ğ·Ğ°Ğ¿ÑƒÑĞº

```bash
# ĞšĞ»Ğ¾Ğ½Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹
git clone <repo-url> /opt/prime
cd /opt/prime

# Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ ÑĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾Ğ¹ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸
sudo ./install-secure.sh
```

### 2. Ğ ÑƒÑ‡Ğ½Ğ°Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° (ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾)

```bash
# Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ firewall
sudo ./infrastructure/firewall/setup-iptables.sh

# Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Docker security
sudo ./install-secure.sh --skip-firewall
```

## ğŸ“‹ ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸

### 1. Egress Proxy (Tinyproxy)

**Ğ Ğ°ÑĞ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ:** `infrastructure/egress/`

**Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸:**
- Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ Ğ´Ğ¾Ğ¼ĞµĞ½Ğ°Ğ¼ (whitelist)
- Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²ÑĞµÑ… Ğ¸ÑÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
- ĞšĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğ¿Ğ¾ IP

**ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ:**
```bash
# ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ»Ğ¾Ğ³Ğ¾Ğ²
sudo tail -f /var/log/tinyproxy/tinyproxy.log

# Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ whitelist
nano infrastructure/egress/whitelist.txt

# ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞº proxy
docker compose -f docker-compose.secure.yml restart egress-proxy
```

### 2. Firewall (UFW + iptables)

**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:**
```bash
# ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°
sudo ufw status verbose
sudo iptables -L -v -n

# Ğ›Ğ¾Ğ³Ğ¸ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ¾Ğº
sudo tail -f /var/log/kern.log | grep PRIME
```

**ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ:**
- Ğ’ĞµÑÑŒ Ğ²Ñ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğ¹ Ñ‚Ñ€Ğ°Ñ„Ğ¸Ğº: `DENY` (ĞºÑ€Ğ¾Ğ¼Ğµ 22, 80, 443)
- Ğ’ĞµÑÑŒ Ğ¸ÑÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğ¹ Ñ‚Ñ€Ğ°Ñ„Ğ¸Ğº: `DENY` (ĞºÑ€Ğ¾Ğ¼Ğµ DNS, HTTPS Ğº whitelist)
- Docker ÑĞµÑ‚Ğ¸: Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸

### 3. Docker Security

**ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸:**
- `internal: true` ÑĞµÑ‚Ğ¸ Ğ´Ğ»Ñ Ğ‘Ğ” Ğ¸ Redis (Ğ½ĞµÑ‚ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ½ĞµÑ‚Ğ°)
- `no-new-privileges` Ğ´Ğ»Ñ Ğ²ÑĞµÑ… ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ¾Ğ²
- `cap_drop: ALL` + Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ `cap_add`
- Non-root Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ Ğ² ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ°Ñ…
- Read-only Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²Ñ‹Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ³Ğ´Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾

### 4. Network Isolation

```yaml
# Ğ¢Ñ€Ğ¸ Ğ¸Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞµÑ‚Ğ¸:
internal-net:  # 172.28.1.0/24 - Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸, NO internet
  internal: true
  
proxy-net:     # 172.28.2.0/24 - Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº egress proxy

public-net:    # 172.28.3.0/24 - Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Caddy ingress
```

## ğŸ” Whitelist Ğ”Ğ¾Ğ¼ĞµĞ½Ğ¾Ğ²

### AI API ĞŸÑ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ñ‹

| ĞŸÑ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€ | Ğ”Ğ¾Ğ¼ĞµĞ½ | ĞŸĞ¾Ñ€Ñ‚ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|-----------|-------|------|----------|
| OpenAI | `api.openai.com` | 443 | GPT-4, GPT-3.5 |
| Anthropic | `api.anthropic.com` | 443 | Claude |
| DeepSeek | `api.deepseek.com` | 443 | DeepSeek Chat |
| Google | `generativelanguage.googleapis.com` | 443 | Gemini |
| Mistral | `api.mistral.ai` | 443 | Mistral AI |
| Cohere | `api.cohere.ai` | 443 | Cohere API |

### Ğ‘Ğ¾Ñ‚ API

| ĞŸĞ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ° | Ğ”Ğ¾Ğ¼ĞµĞ½ | ĞŸĞ¾Ñ€Ñ‚ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|-----------|-------|------|----------|
| Telegram | `api.telegram.org` | 443 | Bot API |
| Discord | `discord.com` | 443 | Gateway |
| Slack | `*.slack.com` | 443 | Slack API |

### Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ

| Ğ¡ĞµÑ€Ğ²Ğ¸Ñ | Ğ”Ğ¾Ğ¼ĞµĞ½ | ĞŸĞ¾Ñ€Ñ‚ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|--------|-------|------|----------|
| DNS | `1.1.1.1` | 53 | Cloudflare DNS |
| DNS | `8.8.8.8` | 53 | Google DNS |
| Time | `pool.ntp.org` | 123 | NTP |

### Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ´Ğ¾Ğ¼ĞµĞ½Ğ°

```bash
# 1. Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ Ğ² whitelist
nano infrastructure/egress/whitelist.txt
# Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ: new-api.example.com

# 2. ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ proxy
docker compose -f docker-compose.secure.yml restart egress-proxy

# 3. Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ Ğ² firewall (ĞµÑĞ»Ğ¸ strict mode)
sudo iptables -A OUTPUT -p tcp -d new-api.example.com --dport 443 -j ACCEPT
```

## ğŸ“Š ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³

### Ğ›Ğ¾Ğ³Ğ¸ Egress

```bash
# Ğ’ÑĞµ Ğ¸ÑÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹
sudo docker compose -f docker-compose.secure.yml logs -f egress-proxy

# Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ (Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚Ğµ LogLevel Ğ² tinyproxy.conf)
grep "DENIED" /var/log/tinyproxy/tinyproxy.log
```

### Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°

```bash
# ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ
sudo ss -tuln | grep 8888

# Docker ÑĞµÑ‚Ğ¸
docker network ls
docker network inspect prime_internal-net

# ĞšĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ñ‹
docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"
```

### ĞĞ»ĞµÑ€Ñ‚Ñ‹

```bash
# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ° Ğ½ĞµĞ¾Ğ±Ñ‹Ñ‡Ğ½ÑƒÑ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ
sudo tail -f /var/log/kern.log | grep -E "(PRIME-EGRESS-BLOCKED|PRIME-HTTPS-BLOCKED)"
```

## ğŸ”§ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ

### Ğ—Ğ°Ğ¿ÑƒÑĞº

```bash
# ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº
cd /opt/prime
sudo docker compose -f docker-compose.secure.yml up -d

# Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Ğ¸ Ğ·Ğ°Ğ¿ÑƒÑĞº
sudo docker compose -f docker-compose.secure.yml up -d --build
```

### ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°

```bash
# ĞœÑĞ³ĞºĞ°Ñ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°
sudo docker compose -f docker-compose.secure.yml down

# ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ñ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸ĞµĞ¼ volumes (Ğ¾ÑÑ‚Ğ¾Ñ€Ğ¾Ğ¶Ğ½Ğ¾!)
sudo docker compose -f docker-compose.secure.yml down -v
```

### ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ

```bash
# ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ´Ğ°
git pull

# ĞŸĞµÑ€ĞµÑĞ±Ğ¾Ñ€ĞºĞ°
sudo docker compose -f docker-compose.secure.yml build --no-cache

# ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞº
sudo docker compose -f docker-compose.secure.yml up -d
```

## ğŸ›¡ï¸ Hardening Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸

### 1. SSH

```bash
# ĞÑ‚ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ root login
sudo sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin no/' /etc/ssh/sshd_config

# ĞÑ‚ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ password auth
sudo sed -i 's/#PasswordAuthentication yes/PasswordAuthentication no/' /etc/ssh/sshd_config

# Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ñ€Ñ‚ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
sudo sed -i 's/#Port 22/Port 2222/' /etc/ssh/sshd_config

sudo systemctl restart sshd
```

### 2. ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ

```bash
# Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° unattended-upgrades
sudo apt install -y unattended-upgrades
sudo dpkg-reconfigure -plow unattended-upgrades
```

### 3. Fail2Ban

```bash
# Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ
sudo fail2ban-client status

# Ğ‘Ğ°Ğ½ IP Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ
sudo fail2ban-client set sshd banip 1.2.3.4

# Ğ Ğ°Ğ·Ğ±Ğ°Ğ½
sudo fail2ban-client set sshd unbanip 1.2.3.4
```

### 4. ĞÑƒĞ´Ğ¸Ñ‚ Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸

```bash
# Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Lynis
sudo apt install -y lynis

# Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ°
sudo lynis audit system
```

## ğŸš¨ Troubleshooting

### API Ğ½Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚

```bash
# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ whitelist
grep "api.example.com" infrastructure/egress/whitelist.txt

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ»Ğ¾Ğ³Ğ¸ proxy
docker compose -f docker-compose.secure.yml logs egress-proxy

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ DNS
nslookup api.openai.com

# Ğ¢ĞµÑÑ‚ Ğ¸Ğ· ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ°
docker compose -f docker-compose.secure.yml exec backend \
    curl -x http://egress-proxy:8888 https://api.openai.com/v1/models \
    -H "Authorization: Bearer $OPENAI_API_KEY"
```

### Firewall Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚ Ğ»ĞµĞ³Ğ¸Ñ‚Ğ¸Ğ¼Ğ½Ñ‹Ğ¹ Ñ‚Ñ€Ğ°Ñ„Ğ¸Ğº

```bash
# Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾ Ğ¾Ñ‚ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ğ¹ egress (Ğ¾ÑÑ‚Ğ¾Ñ€Ğ¾Ğ¶Ğ½Ğ¾!)
sudo iptables -F OUTPUT
sudo iptables -P OUTPUT ACCEPT

# Ğ˜Ğ»Ğ¸ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ¾ Ğ´Ğ»Ñ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ IP
sudo iptables -I OUTPUT -p tcp -d API_IP --dport 443 -j ACCEPT
```

### ĞšĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ½ĞµÑ‚Ğ°

```bash
# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞµÑ‚Ğ¸
docker compose -f docker-compose.secure.yml exec backend \
    curl -I https://api.openai.com

# Ğ”Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ· proxy
docker compose -f docker-compose.secure.yml exec backend \
    env | grep PROXY
# Ğ”Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ:
# HTTP_PROXY=http://egress-proxy:8888
# HTTPS_PROXY=http://egress-proxy:8888
```

## ğŸ“š Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ ĞµÑÑƒÑ€ÑÑ‹

- [Docker Security Best Practices](https://docs.docker.com/develop/security-best-practices/)
- [OWASP Container Security](https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html)
- [CIS Docker Benchmark](https://www.cisecurity.org/benchmark/docker)

---

**Ğ’ĞµÑ€ÑĞ¸Ñ:** 1.0  
**ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾:** 2026-02-15  
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** Production Ready âœ…
